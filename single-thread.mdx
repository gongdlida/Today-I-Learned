# 스레드

동시에 여러 작업이나 프로그램을 실행하는 단위

## 메인 스레드

웹 페이지의 자바스크립트 실행과 렌더링 파이프라인의 핵심 작업은  
주로 메인 스레드에서 수행된다.

메인 스레드는 페이지의 자바스크립트 코드를 실행하며,  
레이아웃 계산(리플로우), 페인트 등 렌더링 과정에 관여한다.  
또한 가비지 컬렉션 등 런타임 작업의 영향으로  
메인 스레드가 일시적으로 중단될 수 있다.

Run-to-completion 특성상 한 태스크 실행 중에는  
다른 태스크가 끼어들지 않으며,  
이로 인해 상태 변경은 예측 가능하다.

하지만 오래 실행되는 자바스크립트 함수가 있을 경우  
메인 스레드를 점유하게 되어 UI가 멈추고  
페이지가 응답하지 않는 문제가 발생할 수 있다.
-> 강제 동기 리플로우, 함수의 무한 루프 등

서비스 워커나 웹 워커를 의도적으로 사용하지 않는 이상,  
자바스크립트 코드는 메인 스레드에서 실행된다.

## 워커 스레드

메인 스레드와 함께 사용할 수 있는 보조 실행 환경으로,  
Web Worker, Shared Worker, Service Worker가 이에 해당한다.

시간이 오래 걸리거나 복잡한 작업을  
메인 스레드와 분리된 환경에서 실행함으로써  
렌더링과 사용자 인터랙션의 성능 저하를 방지할 수 있다.

## Web Worker

Web Worker는 브라우저의 메인 스레드와 분리된  
별도의 이벤트 기반 워커 컨텍스트에서  
자바스크립트 연산을 실행할 수 있는 기술이다.

Worker는 생성자를 통해 생성할 수 있으며(new Worker()),  
메인 스레드와 분리된 실행 환경에서 동작한다.

Web Worker는 메인 스레드와 실행 환경을 공유하지 않으며,  
자체적인 콜 스택, 힙 메모리, 이벤트 루프를 가진다.  
이러한 분리는 DOM이나 렌더링 상태를  
여러 실행 흐름이 동시에 접근하면서 발생할 수 있는  
레이스 컨디션, 강제 동기 레이아웃, 렌더링 안정성 붕괴를  
원천적으로 방지하기 위한 설계이다.

이로 인해 워커에서는 DOM을 직접 조작할 수 없으며,  
window 객체가 제공하는 일부 API 역시 사용할 수 없다.  
사용 가능한 API는 워커 환경에 맞게 제한된다.
(워커 내부에서도 microtask 우선 규칙은 동일하다.)

생성된 워커는 메인 스레드와  
메시지 기반(postMessage)으로만 통신할 수 있으며,  
전달되는 데이터는 기본적으로 structured clone 방식으로  
복제되어 전달된다.

-> 메인 스레드와 워커 사이의 데이터는  
 깊은 복사로 전달되어 상태를 공유하지 않으며,  
 안전하지만 복사 비용이 발생한다.
